---
interface Member {
  uuid: string;
  online: boolean;
  server: string | null;
  contributed: number;
  contributionRank: number;
  joined: string;
}

interface MemberData {
  [key: string]: Member;
}

interface GuildData {
  members: {
    owner?: MemberData;
    chief?: MemberData;
    strategist?: MemberData;
  };
}

interface OnlineMember {
  name: string;
  rank: string;
  server: string;
}

let onlineMembers: OnlineMember[] = [];
let error: string | null = null;

try {
  const response = await fetch('https://api.wynncraft.com/v3/guild/Returners');
  
  if (!response.ok) {
    throw new Error(`API request failed: ${response.status}`);
  }
  
  const data: GuildData = await response.json();
  
  // Process owners
  if (data.members.owner) {
    for (const [name, member] of Object.entries(data.members.owner)) {
      if (member.online && member.server) {
        onlineMembers.push({
          name,
          rank: 'Owner',
          server: member.server
        });
      }
    }
  }
  
  // Process chiefs
  if (data.members.chief) {
    for (const [name, member] of Object.entries(data.members.chief)) {
      if (member.online && member.server) {
        onlineMembers.push({
          name,
          rank: 'Chief',
          server: member.server
        });
      }
    }
  }
  
  // Process strategists
  if (data.members.strategist) {
    for (const [name, member] of Object.entries(data.members.strategist)) {
      if (member.online && member.server) {
        onlineMembers.push({
          name,
          rank: 'Strategist',
          server: member.server
        });
      }
    }
  }
} catch (e) {
  error = e instanceof Error ? e.message : 'Unknown error occurred';
  console.error('Failed to fetch guild data:', e);
}
---

<div id="strategist" class="glass-t p-4 rounded-lg m-4">
  <h6>A list of online strategists can be found here:</h6>
  
  {error ? (
    <p class="text-red-500">Failed to load guild data: {error}</p>
  ) : onlineMembers.length > 0 ? (
    <ul class="space-y-2">
      {onlineMembers.map((member) => (
        <li class="flex justify-between items-center p-2 bg-opacity-10 bg-white dark:bg-opacity-10 dark:bg-black rounded">
          <div>
            <span class="font-semibold">{member.name}</span>
            <span class="text-sm text-txt-light dark:text-darkmode-txt-light ml-2">({member.rank})</span>
          </div>
          <span class="text-sm bg-green-500 bg-opacity-20 px-2 py-1 rounded">{member.server}</span>
        </li>
      ))}
    </ul>
  ) : (
    <p class="text-txt-light dark:text-darkmode-txt-light">No leadership members currently online.</p>
  )}
</div>
